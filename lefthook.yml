pre-commit:
  piped: true
  commands:
    1_lint:
      glob: "*.dart"
      run: |
        dart fix --apply
        # pids=""
        # for FILE in {staged_files}
        # do
        #   dart fix --apply "${FILE}" &
        #   pid=$!
        #   pids+=" ${pid}"
        # done
        # for pid in $pids
        # do
        #   if ! wait "$pid"
        #   then
        #     exit 1
        #   fi
        # done
      stage_fixed: true
    2_format:
      glob: "*.dart"
      run: dart format {staged_files}
      stage_fixed: true
    3_analyze:
      glob: "*.dart"
      run: dart analyze {staged_files}

pre-push:
  commands:
    test_cli:
      root: "cli/"
      run: |
        dart test
    test_package:
      root: "vibe/"
      run: |
        flutter test
